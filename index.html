<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ehud Karavani">
<meta name="dcterms.date" content="2024-04-20">
<meta name="keywords" content="Causal inference, Data visualization, Standardized difference, Model evaluation, Variable selection, Balance, Observational study, Propensity score, Matching">

<title>Oui-Love Plots: Outcome-informed Love plots for covariate balance in causal inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="citation_title" content="Oui-Love Plots: Outcome-informed Love plots for covariate balance in causal inference">
<meta name="citation_keywords" content="Causal inference,Data visualization,Standardized difference,Model evaluation,Variable selection,Balance,Observational study,Propensity score,Matching">
<meta name="citation_author" content="Ehud Karavani">
<meta name="citation_publication_date" content="2024-04-20">
<meta name="citation_cover_date" content="2024-04-20">
<meta name="citation_year" content="2024">
<meta name="citation_online_date" content="2024-04-20">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=A review of the use of propensity score diagnostics in papers published in high-ranking medical journals;,citation_author=Emily Granger;,citation_author=Tim Watkins;,citation_author=Jamie C Sergeant;,citation_author=Mark Lunt;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=20;,citation_journal_title=BMC medical research methodology;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Reporting of covariate selection and balance assessment in propensity score analysis is suboptimal: A systematic review;,citation_author=M Sanni Ali;,citation_author=Rolf HH Groenwold;,citation_author=Svetlana V Belitser;,citation_author=Wiebe R Pestman;,citation_author=Arno W Hoes;,citation_author=Kit CB Roes;,citation_author=Anthonius Boer;,citation_author=Olaf H Klungel;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_issue=2;,citation_volume=68;,citation_journal_title=Journal of clinical epidemiology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Causal knowledge as a prerequisite for confounding evaluation: An application to birth defects epidemiology;,citation_author=Miguel A Hernán;,citation_author=Sonia Hernández-Dı́az;,citation_author=Martha M Werler;,citation_author=Allen A Mitchell;,citation_publication_date=2002;,citation_cover_date=2002;,citation_year=2002;,citation_issue=2;,citation_volume=155;,citation_journal_title=American journal of epidemiology;,citation_publisher=Oxford University Press;">
<meta name="citation_reference" content="citation_title=Use of directed acyclic graphs (DAGs) to identify confounders in applied health research: Review and recommendations;,citation_author=Peter WG Tennant;,citation_author=Eleanor J Murray;,citation_author=Kellyn F Arnold;,citation_author=Laurie Berrie;,citation_author=Matthew P Fox;,citation_author=Sarah C Gadd;,citation_author=Wendy J Harrison;,citation_author=Claire Keeble;,citation_author=Lynsie R Ranker;,citation_author=Johannes Textor;,citation_author=others;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=2;,citation_volume=50;,citation_journal_title=International journal of epidemiology;,citation_publisher=Oxford University Press;">
<meta name="citation_reference" content="citation_title=Causal diagrams for epidemiologic research;,citation_author=Sander Greenland;,citation_author=Judea Pearl;,citation_author=James M Robins;,citation_publication_date=1999;,citation_cover_date=1999;,citation_year=1999;,citation_issue=1;,citation_volume=10;,citation_journal_title=Epidemiology;,citation_publisher=LWW;">
<meta name="citation_reference" content="citation_title=Instrumental variables as bias amplifiers with general outcome and confounding;,citation_author=Peng Ding;,citation_author=TJ VanderWeele;,citation_author=James M Robins;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=2;,citation_volume=104;,citation_journal_title=Biometrika;,citation_publisher=Oxford University Press;">
<meta name="citation_reference" content="citation_title=Balance diagnostics for comparing the distribution of baseline covariates between treatment groups in propensity-score matched samples;,citation_author=Peter C Austin;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_issue=25;,citation_volume=28;,citation_journal_title=Statistics in medicine;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Heart failure, chronic diuretic use, and increase in mortality and hospitalization: An observational study using propensity score methods;,citation_author=Ali Ahmed;,citation_author=Ahsan Husain;,citation_author=Thomas E Love;,citation_author=Giovanni Gambassi;,citation_author=Louis J Dell’Italia;,citation_author=Gary S Francis;,citation_author=Mihai Gheorghiade;,citation_author=Richard M Allman;,citation_author=Sreelatha Meleth;,citation_author=Robert C Bourge;,citation_publication_date=2006;,citation_cover_date=2006;,citation_year=2006;,citation_issue=12;,citation_volume=27;,citation_journal_title=European heart journal;,citation_publisher=Oxford University Press;">
<meta name="citation_reference" content="citation_title=Regression modeling strategies: With applications to linear models, logistic regression, and survival analysis;,citation_author=Frank E Harrell;,citation_author=others;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;">
<meta name="citation_reference" content="citation_title=Understanding machine learning: From theory to algorithms;,citation_author=Shai Shalev-Shwartz;,citation_author=Shai Ben-David;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;">
<meta name="citation_reference" content="citation_title=Fundamentals of data visualization: A primer on making informative and compelling figures;,citation_author=Claus O Wilke;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=Principles of confounder selection;,citation_author=Tyler J VanderWeele;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=34;,citation_journal_title=European journal of epidemiology;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Random forests;,citation_author=Leo Breiman;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_volume=45;,citation_journal_title=Machine learning;,citation_publisher=Springer;">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Oui-Love Plots: Outcome-informed Love plots for covariate balance in causal inference</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Author</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Ehud Karavani <a href="mailto:ehudk@ibm.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-0187-5437" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        IBM Research, Israel
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">April 20, 2024</p>
            </div>
          </div>
          
                <div>
            <div class="quarto-title-meta-heading">Modified</div>
            <div class="quarto-title-meta-contents">
              <p class="date-modified">May 3, 2024</p>
            </div>
          </div>
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>


    <div>
      <div class="keywords">
        <div class="block-title">Keywords</div>
        <p>Causal inference, Data visualization, Standardized difference, Model evaluation, Variable selection, Balance, Observational study, Propensity score, Matching</p>
      </div>
    </div>

    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#outcome-informed-love-plot" id="toc-outcome-informed-love-plot" class="nav-link" data-scroll-target="#outcome-informed-love-plot">Outcome-informed Love plot</a></li>
  <li><a href="#outcome-informed-balance-metrics" id="toc-outcome-informed-balance-metrics" class="nav-link" data-scroll-target="#outcome-informed-balance-metrics">Outcome-informed balance metrics</a>
  <ul class="collapse">
  <li><a href="#augmenting-love-plot-with-outcome-informed-asmd-scores" id="toc-augmenting-love-plot-with-outcome-informed-asmd-scores" class="nav-link" data-scroll-target="#augmenting-love-plot-with-outcome-informed-asmd-scores">Augmenting Love plot with outcome-informed ASMD scores</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#covariate-balance-measures" id="toc-covariate-balance-measures" class="nav-link" data-scroll-target="#covariate-balance-measures">Covariate balance measures</a></li>
  <li><a href="#covariate-importance-measures" id="toc-covariate-importance-measures" class="nav-link" data-scroll-target="#covariate-importance-measures">Covariate importance measures</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  
  </ul>
<div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="notebooks\dag_dgp_1-preview.html"><i class="bi bi-journal-code"></i>Data generating process 1</a></li><li><a href="notebooks\ouilove_plot-preview.html"><i class="bi bi-journal-code"></i>Outcome-informed Love plot</a></li><li><a href="notebooks\ouibalance_plot-preview.html"><i class="bi bi-journal-code"></i>Outcome-informed balance plots</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">



  


<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>Assessing balance between exposure groups by visualizing the absolute standardized mean differences (ASMD) in a Love plot is a common approach to diagnose models like propensity score weighting or matching. However, the ASMD only captures covariate-exposure associations and neglects to integrate information about the covariate-outcome associations. <!-- Since causal inference researchers often select covariates for adjustment sets based on a-priori domain expertise (e.g., via a directed acyclic graph), 
they are at higher risk at treating instrumental variables or prognostic factors as confounders.  --> Since adjustment sets are often defined a-priori to the data (e.g., via directed acyclic graphs), there is an increased risk of classifying variables as confounders even if they are not actually associated with both the exposure and the outcome in the data. Furthermore, since only confounders should be balanced across exposure groups, assessing the balance of non-confounders can create a skewed picture of the required balance and may mislead researchers to pursue balancing where it is not necessary.</p>
<p>To overcome this issue, we propose the Oui-Love plot: an OUtcome-Informed Love plot, consisting of two main parts. First, we introduce an outcome-informed ASMD score by incorporating covariate-outcome importance measures with the ASMD. Second, since we love plots, this additional score is visualized through several graphical channels (opacity, marker size, and covariate order) to augment the standard Love plot. This enhanced Love plot can better assist researchers to evaluate balancing on variables that are more likely to bias treatment effects in the data at hand by emphasizing variables that are statistically associated with both exposure and the outcome. The method is modular and easy to implement with modern statistical software and may hopefully benefit causal inference researchers and practitioners.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Covariate balancing is a significant and essential concept for causal inference from observational studies. Generally, balance diagnostics assess the difference in covariate distribution between exposures levels. Intuitively, if the covariate distribution is the same across exposure groups, there will be no systematic bias in exposure and difference in outcomes will only be due to the exposure status. Therefore, balancing is the most common diagnostics for assessing balancing methods, like inverse propensity weighting (IPW) or matching <span class="citation" data-cites="ali2015reporting granger2020review">(<a href="#ref-ali2015reporting" role="doc-biblioref">Ali et al. 2015</a>; <a href="#ref-granger2020review" role="doc-biblioref">Granger et al. 2020</a>)</span>.</p>
<p>Ideally, covariate balance is assessed over <em>confounding variables</em>. These are variables affecting both the exposure and the outcome, and which failing to adjust for can introduce bias when examining the influence of the exposure on the outcome <span class="citation" data-cites="hernan2002causal">(<a href="#ref-hernan2002causal" role="doc-biblioref">Hernán et al. 2002</a>)</span>. <!-- Usually, we would like to examine how pre-adjustment confounders differ across exposure groups, and whether adjustment (like IPW or Matching) was able to reduce those differences, effectively eliminating their contribution on the outcome, and therefore isolating the effect of exposure. --> Adjusting for these confounders reduces their difference across exposure groups, effectively equaling their influence on the outcome across exposure groups; thus enabling the model to isolate the effect of the exposure.</p>
<p>Whether a variable is a confounder cannot be determined from the data itself. Therefore, the most common approach to select confounders for an adjustment set <!-- (and more generally, how any pair of variables interact)  --> is to let a domain expert hand pick them manually <span class="citation" data-cites="hernan2002causal tennant2021use">(<a href="#ref-hernan2002causal" role="doc-biblioref">Hernán et al. 2002</a>; <a href="#ref-tennant2021use" role="doc-biblioref">Tennant et al. 2021</a>)</span>. The structure arising from this specification is often formulated and presented as a Directed Acyclic Graph (DAG), where variables are depicted as nodes and two nodes are connected by an arrow if one causally influences the other <span class="citation" data-cites="greenland1999causal">(<a href="#ref-greenland1999causal" role="doc-biblioref">Greenland, Pearl, and Robins 1999</a>)</span>. <!-- Since This formulation of the structure of the problem, often through a Directed Acyclic Graph (DAG),  --> When specifying how any pair of variables interact, the omission of an edge – assuming there is no association whatsoever – is a much stronger assumption than its inclusion – allowing the model to infer zero association from the data. Thus, when determining the structure, modellers may prefer to err on the inclusion of edges, rather than their omission <span class="citation" data-cites="tennant2021use greenland1999causal">(<a href="#ref-tennant2021use" role="doc-biblioref">Tennant et al. 2021</a>; <a href="#ref-greenland1999causal" role="doc-biblioref">Greenland, Pearl, and Robins 1999</a>)</span>.</p>
<p>Most importantly, since the structure – and therefore the confounders – are determined a-priori, based on prior knowledge rather than data, we denote them <em>structural confounders</em>. However, an a-priori <em>structural confounder</em> may not necessarily be an a-posteriori <em>statistical confounder</em>. Namely, the prior assumption a variable is associated with both exposure and outcome may not manifest at the data at hand. This is quite plausible, even in the absence of finite sampling errors, since we often build DAGs one pair at a time, failing to grasp how many factors may interact to determine the exposure or outcome conditioned on all the other factors. For instance, a factor we assumed is considered when prescribing medicine may not be used, or we can fail to understand the mechanism under which a certain factor conditionally explains the outcome. Both will result with the factor not being statistically associated with the exposure or outcome, respectively (or both).</p>
<p>Therefore, covariate balance assessments that only capture covariate-exposure associations can be insufficient. For example, such a putative confounder may heavily influence differential exposure, leading to high imbalance, but have no impact on the outcome (these may be referred to as instrumental variables). In such cases, it will be unnecessary (or even harmful <span class="citation" data-cites="ding2017instrumental">(<a href="#ref-ding2017instrumental" role="doc-biblioref">Ding, VanderWeele, and Robins 2017</a>)</span>) to balance over that putative confounder. However, commonly used diagnostics like the (Absolute) Standardized Mean Difference (ASMD) <span class="citation" data-cites="austin2009balance">(<a href="#ref-austin2009balance" role="doc-biblioref">Austin 2009</a>)</span> and the corresponding Love plot <span class="citation" data-cites="ahmed2006heart">(<a href="#ref-ahmed2006heart" role="doc-biblioref">Ahmed et al. 2006</a>)</span> will fail to capture that and may mislead the researcher to focus on where they should not.</p>
<p>To overcome this issues, information about the covariate-outcome association should be incorporated to provide a fuller picture. Fortunately, assessing the statistical importance of a variable on an outcome is a very known problem in regression modeling and machine learning <span class="citation" data-cites="harrell2001regression shalev2014understanding">(<a href="#ref-harrell2001regression" role="doc-biblioref">Harrell et al. 2001, chap. 9.8.4</a>; <a href="#ref-shalev2014understanding" role="doc-biblioref">Shalev-Shwartz and Ben-David 2014, chap. 25</a>)</span>. Assessing covariate-outcome importance will provide us with additional information orthogonal and complementary to the covariate-exposure balance assessment. This will allow us to, literally speaking, paint a fuller picture about confounder imbalance.</p>
<p>Our contribution in this manuscript is twofold. First, we will provide visual augmentation to the known Love plot based on both standardized mean difference and covariate-outcome importance. Second, we will combine both measures together to suggest a better metric for covariate/model selection and further enhance Love plots or any other balance assessment plots.</p>
</section>
<section id="outcome-informed-love-plot" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="outcome-informed-love-plot">Outcome-informed Love plot</h2>
<div class="page-columns page-full">
<div class="quarto-embed-nb-cell page-columns page-full">
<div id="cell-fig-love-oui-love" class="cell page-columns page-full" data-execution_count="42">
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-love-oui-love" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-love-oui-love-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<a href="index_files/figure-html/notebooks-ouilove_plot-fig-love-oui-love-output-1.svg" class="lightbox page-columns page-full" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1"><img src="index_files/figure-html/notebooks-ouilove_plot-fig-love-oui-love-output-1.svg" class="img-fluid figure-img column-screen-inset"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-love-oui-love-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Outcome-informed Love plot. On the left, a standard Love plot, showing covariates on the y-axis sorted by unadjusted ASMD, ASMD on the x-axis, unadjusted ASMDs as orange triangle and inverse propensity weighted ASMDs as blue circles. On the right, an Outcome-informed Love plot, encoding the combined importance of covariates on outcome prediction and exposure imbalance in three different visual channels: size (less important covariates are smaller), opacity(less important covariates are more transparent), and y-axis order (less important covariates are further down the panel). Outcome-informed Love plots reduce clutter and highlight the more important covariates to which examine balancing on.
</figcaption>
</figure>
</div>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-1" href="notebooks\ouilove_plot-preview.html#cell-fig-love-oui-love">Source: Outcome-informed Love plot</a></div>
</div>
<!-- See possible refs: https://socviz.co/lookatdata.html (1.5); https://clauswilke.com/dataviz/aesthetic-mapping.html; https://web.cse.ohio-state.edu/~shen.94/Melbourne/Slides/TamaraChp5.pdf; https://uwdata.github.io/visualization-curriculum/altair_marks_encoding.html; https://www.csl.mtu.edu/cs5631.ck/common/05-Marks-Channels.pdf; -->
<!-- ### Grammar of graphics -->
<!-- To justify our approach, we briefly introduce the basic concept behind data visualization. -->
<p>Data visualization allows us to encode numeric data values as visual elements. When we “visualize data” we essentially map between data values to graphical elements. Good, consistent visualization will map different dimensions of the data to different types of encoding channels using appropriate graphical marks <span class="citation" data-cites="wilke2019fundamentals">(<a href="#ref-wilke2019fundamentals" role="doc-biblioref">Wilke 2019, chap. 2</a>)</span>.</p>
<p>For instance, a traditional Love plot (<a href="#fig-love-oui-love" class="quarto-xref">Figure&nbsp;1</a>) maps the covariates to the y-axis - so each covariate gets its own row, the (absolute) standardized mean difference (ASMD) of each covariate to the x-axis, the type of the model (e.g., weighted/unweighted) to the color (blue/orange) and possibly also to different markers (circle/triangle). All in all, we mapped three data dimensions: covariates, their ASMD, and adjustment model, to three graphical channels: y-axis, x-axis, and color (and possibly a fourth channel of marker shape for emphasis).</p>
<p>In an outcome-informed Love plot, we calculate an additional data dimension: the covariate-outcome impact (“feature importance”) of each covariate on the outcome. The covariate-outcome importance is a non-negative score positively associated with importance. There are several approaches to calculate feature importance, which we describe in more details in the <a href="#methods">Methods</a> section, <!-- but briefly, a low score indicates relatively small importance -- a change in the covariate levels is associated with little change in the predicted outcome, 
and a high score indicates relatively high importance -- a change in the covariate levels is associated with large changes in the predicted outcome. --> but briefly, a low score indicates relatively small importance – the exclusion of the covariate causes small changes in prediction error, nd a high score indicates relatively high importance – the exclusion of the covariate causes large changes in the prediction error. Put differently, more important covariates explain more variation in the outcome and contribute more to the accuracy<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> of the prediction.</p>
<p>To augment the traditional Love plot, the additional dimension for the covariate-outcome importance score is mapped to one or more visual channels. In this work we suggest three candidate channels, which can be arbitrarily combined:</p>
<ol type="1">
<li>The opacity channel. Marks corresponding to more important covariates are more opaque, while less important marks are more transparent.</li>
<li>The size channel. Marks corresponding to more important covariate are larger, while less important marks are smaller.</li>
<li>The order of the y-axis. Covariates are ranked by their importance with more important covariates appearing on top.</li>
</ol>
<p>See <a href="#fig-oui-encoding" class="quarto-xref">Figure&nbsp;2</a> for a graphical example of each.</p>
<p>The common property for options (1) and (2) is that less important covariates appear less prominent, either being smaller or more transparent. The argument being that if they do not influence the outcome, they will not bias the estimation, and therefore are not important and less interesting to examine. If they are less interesting to examine, there is less need for them to stand out and can therefore be salient. This will reduce clutter and allow the viewer to focus on the more important (and thus visually prominent) covariates. Meanwhile, option (3) clusters more important covariates to specific regions of the plot, but breaks the standard of ordering covariates by the unadjusted ASMD that may be familiar to practitioners. All options achieve a similar objective of differential attention onto more important covariates, either by differential prominence (transparency and size) or by differential spatial location (order). <!-- See Figure [cross ref] for details. --></p>
<div class="page-columns page-full">
<div class="quarto-embed-nb-cell page-columns page-full">
<div id="cell-fig-oui-encoding" class="cell page-columns page-full" data-execution_count="40">
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-oui-encoding" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-oui-encoding-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<a href="index_files/figure-html/notebooks-ouilove_plot-fig-oui-encoding-output-1.svg" class="lightbox page-columns page-full" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2"><img src="index_files/figure-html/notebooks-ouilove_plot-fig-oui-encoding-output-1.svg" class="img-fluid figure-img column-body-outset"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oui-encoding-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Encoding covariate-outcome importance information as marker opacity, marker size, and covariate order. Opacity and size allow less important covariates to appear more salient by making them more transparent or smaller, respectively. Y-axis order moves less important covariates further down the plot, focusing more important covariates in a specific region of the figure.
</figcaption>
</figure>
</div>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-2" href="notebooks\ouilove_plot-preview.html#cell-fig-oui-encoding">Source: Outcome-informed Love plot</a></div>
</div>
</section>
<section id="outcome-informed-balance-metrics" class="level2">
<h2 class="anchored" data-anchor-id="outcome-informed-balance-metrics">Outcome-informed balance metrics</h2>
<p>Oftentimes, we use the ASMD for model selection. For instance, the maximum ASMD after adjustment (e.g., weighting or matching) across all covariates can be considered as a good summary of the Love plot. Maximal post-adjustment ASMD describes the worst case scenario for imbalance. If our model can keep the max ASMD – and therefore the ASMD for all covariates – under reasonable tolerance (0.1 threshold is arbitrarily but commonly used), then we can gain further trust in the downstream effect being estimated. Once we have a single numeric metric that can diagnose model performance, we can use it to choose between two (or more) candidate models, choosing the one with minimal post-adjustment max ASMD.</p>
<p>However, as argued above, ASMD alone can be a poor diagnostic. If the covariate with max ASMD has little influence on the outcome, there is little benefit in making the effort to improve its balance. That covariate should not be part of the model’s objective. In fact, that covariate creates a distorted image of the desired confounder balance.</p>
<p>One possible solution is combining the ASMD with the covariate-outcome importance measures into a single numeric score. In this manuscript, we argue for the multiplication of the two, as it can assess the interaction of the two orthogonal measures. Specifically, it addresses the issue depicted above naturally, by allowing the two measures to cancel out each other (<a href="#fig-oui-asmd-score" class="quarto-xref">Figure&nbsp;3</a>). For example, small covariate-outcome importance will lead to small score overall, regardless of how large or small is the corresponding ASMD, <!-- and similarly for small ASMD.  --> and vice versa. <!-- This answers directly the desiderata --> High scoring covariates will, therefore, only be comprised of both large ASMD <em>and</em> large covariate-outcome importance - meaning strong covariate-exposure association and strong covariate-outcome association, which is exactly the definition of a confounder.</p>
<div class="quarto-embed-nb-cell">
<div id="cell-fig-oui-asmd-score" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display">
<div id="fig-oui-asmd-score" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oui-asmd-score-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/notebooks-ouilove_plot-fig-oui-asmd-score-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3"><img src="index_files/figure-html/notebooks-ouilove_plot-fig-oui-asmd-score-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oui-asmd-score-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Outcome-informed ASMD score. A) Inverse propensity weighted ASMD, with 0.1 threshold reference (dashed) B) Covariate-outcome importance score (mean decrease in mean square error). C) Outcome-informed ASMD, generated by multiplying the above two. The ASMD emphasizes covariate-exposure associations (<span class="math inline">\(X_A, X_{AY}\)</span>), the outcome-importance score emphasizes covariate-outcome associations (<span class="math inline">\(X_Y, X_{AY}\)</span>), and outcome-informed ASMD emphasizes the interaction of the former two scores (<span class="math inline">\(X_{AY}\)</span>).<br>

</figcaption>
</figure>
</div>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-3" href="notebooks\ouilove_plot-preview.html#cell-fig-oui-asmd-score">Source: Outcome-informed Love plot</a></div>
<section id="augmenting-love-plot-with-outcome-informed-asmd-scores" class="level3">
<h3 class="anchored" data-anchor-id="augmenting-love-plot-with-outcome-informed-asmd-scores">Augmenting Love plot with outcome-informed ASMD scores</h3>
<p>This limitation of using covariate-outcome importance alone is also relevant when augmenting Love plots. Namely, it may over-emphasize prognostic variables. Those may still be visually differentiated from confounders by having small ASMDs (because they have no covariate-exposure association), but this still forces the researcher to be more mindful when examining the plot for imbalance in confounding factors.</p>
<p>To assist the researcher even further, we can use the combined outcome-informed ASMD score instead of just the outcome-importance score. This allows confounding variables, associated with both the exposure and the outcome, to be further promoted above prognostic variables when plotting, making them stand out more. <a href="#fig-ouiasmd-love" class="quarto-xref">Figure&nbsp;5</a> shows the difference between an outcome-informed Love plot and a Love plot augmented by outcome-informed ASMD score. All other figures (Figures <a href="#fig-love-oui-love" class="quarto-xref">1</a>, <a href="#fig-oui-encoding" class="quarto-xref">2</a>, <a href="#fig-oui-bal-plot" class="quarto-xref">6</a>) use the combined outcome-informed ASMD score.</p>
</section>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<section id="covariate-balance-measures" class="level3">
<h3 class="anchored" data-anchor-id="covariate-balance-measures">Covariate balance measures</h3>
<p>The task of assessing covariate balancing is essentially a two-sample test between the exposed and unexposed. Since two-sample tests often do not scale, making the comparison of two multivariable distributions ill-defined, researchers resort to comparing multiple univariable distributions by examining each covariate separately. For balance assessment in causal inference modeling, the most common metric used is the standardized mean difference (SMD). The SMD is the difference in covariate averages divided by the pooled standard error. Mathematically, for each covariate <span class="math inline">\(j\)</span> we define: <span class="math display">\[
SMD_j = \frac{\bar{x}_j \vert_{A=1}- \bar{x}_j\vert_{A=0}}{\sqrt{\hat{\sigma}_j^2\vert_{A=1} + \hat{\sigma}_j^2\vert_{A=0}}}
\]</span></p>
<p>Where <span class="math inline">\(\bar{x}_j \vert_{A=1}\)</span> is the average of feature <span class="math inline">\(x_j\)</span> among those exposed, and <span class="math inline">\(\hat{\sigma}_j^2\vert_{A=0}\)</span> is the estimated standard deviation of <span class="math inline">\(x_j\)</span> among the unexposed. Furthermore, since the direction of the bias is insignificant for our purposes, we further take the absolute value and denote the <span class="math inline">\(ASMD_j = \left\vert SMD_j \right\vert\)</span>.</p>
</section>
<section id="covariate-importance-measures" class="level3">
<h3 class="anchored" data-anchor-id="covariate-importance-measures">Covariate importance measures</h3>
<p>The task of assessing the influence of covariates on an outcome is a well established task in statistics, often utilized for dimensionality reduction (feature selection) or model selection. There are multiple approaches to compute this importance: regression models can use absolute magnitude of coefficients (assuming input is standardized), or non-zero coefficients in L1-penalized regression (LASSO). A more model agnostic approach, the covariate importance can be assessed by how “excluding” each covariate affects some goodness-of-fit metric. This “exclusion” is either done by removing the feature entirely <span class="citation" data-cites="harrell2001regression">(<a href="#ref-harrell2001regression" role="doc-biblioref">Harrell et al. 2001, chap. 9.8.4</a>)</span> from the model or just shuffling its values across observations <span class="citation" data-cites="breiman2001random">(<a href="#ref-breiman2001random" role="doc-biblioref">Breiman 2001, sec. 10</a>)</span> (the latter may also be evaluated on an out-of-sample test split). The goodness-of-fit measure evaluated can be any arbitrary metric like decreasing the loss or increasing the accuracy. The change in goodness-of-fit can either be multiplicative or additive, grounding the full model (with all covariates) as the baseline to compare against. Covariates that are more important for predicting the outcome will cause larger decrease in performance relative to the full model (that includes these covariates), meaning they are the ones driving the accuracy of the predictions.</p>
<!-- [^2]: Colloquially speaking. For risk models, it can be mean calibration error (if you care about calibration), or area under the receiver of operating curve (if you care about discrimination), or any other confusion matrix-based metric.  -->
<p>In this work, our goodness-of-fit metric is the natural deviance, which, since our outcome is continuous, is the mean squared error. <!-- The importance of a covariate is defined as the difference in deviance between the full model and the model fitted with that covariate removed (divided by the deviance of the full model, similar to percent change calculations.) --> The importance of a covariate is defined using the mean decrease in accuracy <span class="citation" data-cites="breiman2001random">(<a href="#ref-breiman2001random" role="doc-biblioref">Breiman 2001</a>)</span> – the percentage change in deviance between the full model and the model fitted with that covariate removed. <!-- Additionally, we consider only importance measures that are conditional on all other covariates and the exposure.
Namely, we don't consider multiple univariable importance measures, and we always additionally condition on the exposure [@vanderweele2019principles].  --> Importantly, we do not consider univariable importance measures, but rather a metric that is always conditional on the rest of the covariates and the exposure <span class="citation" data-cites="vanderweele2019principles">(<a href="#ref-vanderweele2019principles" role="doc-biblioref">VanderWeele 2019</a>)</span>. However, the outcome-informed Love plot can work with any arbitrary non-negative importance measure, as long as lower scores correspond to little importance and higher scores to high importance.</p>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>We present our augmented Love plot on a minimally sufficient data simulation. The simulation includes four covariates, one (<span class="math inline">\(X_0\)</span>) is not associated with neither the exposure (<span class="math inline">\(A\)</span>) nor the outcome (<span class="math inline">\(Y\)</span>), one (<span class="math inline">\(X_A\)</span>) is associated only with the exposure, another (<span class="math inline">\(X_Y\)</span>) only with the outcome, and one true confounder (<span class="math inline">\(X_{AY}\)</span>) that is associated with both. Mathematically, the full generating process is <span class="math display">\[
\begin{aligned}
  Y &amp;\sim A + X_Y + X_{AY} + \epsilon \\  
  A &amp;\sim \text{Bernoulli}(\pi) \\  
  \text{logit}(\pi) &amp;= X_A + X_{AY} \\  
  X_0, X_A, X_Y, X_{AY} &amp;\sim \text{Normal}(0, 1) \\
  \epsilon &amp;\sim \text{Normal}(0, 1)
\end{aligned}
\]</span></p>
<p>The directed acyclic graph depicting this setting (<a href="#fig-dag1" class="quarto-xref">Figure&nbsp;4</a>) describes a setting where <span class="math inline">\(X_0, X_A, X_Y\)</span> are wrongly considered to be confounders (influence both exposure and outcome) a-priori, but are actually not.</p>
<!-- ::: {.column-margin} -->
<div class="quarto-embed-nb-cell">
<div id="cell-fig-dag1" class="cell" data-execution_count="15">
<div class="cell-output cell-output-display">
<div id="fig-dag1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/notebooks-dag_dgp_1-fig-dag1-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" data-glightbox="description: .lightbox-desc-4"><img src="index_files/figure-html/notebooks-dag_dgp_1-fig-dag1-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Confounding structure underlying the simulation example. Right is the true confounding structure where <span class="math inline">\(X_0\)</span> is not associated with neither the exposure <span class="math inline">\(A\)</span> nor the outcome <span class="math inline">\(Y\)</span>, <span class="math inline">\(X_A\)</span> only influence the exposure, <span class="math inline">\(X_Y\)</span> only influences the outcome, and <span class="math inline">\(X_{AY}\)</span> is the only true confounder influencing both <span class="math inline">\(A\)</span> and <span class="math inline">\(Y\)</span>. Left is the assumed confounding structure where all variables assumed to be confounders influencing both the treatment and the outcome. Wrongly specified edges are depicted red and dashed.
</figcaption>
</figure>
</div>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-4" href="notebooks\dag_dgp_1-preview.html#cell-fig-dag1">Source: Data generating process 1</a></div>
<!-- ::: -->
<!-- ## Results? -->
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>We further present advantages, limitations, and extensions to the outcome-informed Love plots.</p>
<section id="augmenting-more-than-just-love-plots" class="level4">
<h4 class="anchored" data-anchor-id="augmenting-more-than-just-love-plots">Augmenting more than just Love plots</h4>
<p>The augmentation presented, encoding covariate-outcome importance in the opacity and/or size channels, is not only limited to the standard, traditional Love plot. Covariate imbalance, pre- and post-adjustment, can sometimes be presented as either scatter plots or slope-graphs. In scatter plots, the adjusted and unadjusted ASMDs are plotted on the x and y axes. In slope graphs, the pre/post-adjustment indication is mapped to the x-axis and the ASMD to the y-axis. Scatter plots are better suited for high-dimensional settings where plotting all covariates on the y-axis is infeasible (or at least too crowded). Slope graphs have a similar strength, compromising some information richness (covariate identity) in exchange of emphasizing overall reduction in ASMD. <a href="#fig-oui-bal-plot" class="quarto-xref">Figure&nbsp;6</a> demonstrates both variants can benefit by the same augmenting encoding.</p>
</section>
<section id="assessing-the-utility-of-outcome-informed-love-plots" class="level4">
<h4 class="anchored" data-anchor-id="assessing-the-utility-of-outcome-informed-love-plots">Assessing the utility of Outcome-informed Love plots</h4>
<p>The main limitation of this manuscript is that its fundamental premise is not validated empirically. We <em>believe</em> outcome-informed Love plots are useful since we are practitioners and we found them to be so. However, anecdotal evidence is not good evidence. The proper way to examine the utility of our suggested augmentation is to conduct a user study, providing causal inference practitioners with the traditional Love plot and our extension (even breaking down the different channels and their combinations) and evaluating whether they indeed benefitted from it. This kind of work, however, is out of scope for the current manuscript.</p>
</section>
<section id="scale-less-relative-ranking" class="level4">
<h4 class="anchored" data-anchor-id="scale-less-relative-ranking">Scale-less relative ranking</h4>
<p>A second limitation considers the lack of interpretable, absolute scale for the outcome-informed ASMD score. The original ASMD has a clear scale in standard deviation units of the data. It is well-established and can be interpreted as Cohen’s d (<span class="citation" data-cites="austin2009balance">Austin (<a href="#ref-austin2009balance" role="doc-biblioref">2009</a>)</span>), <!-- It can both be interpreted as Cohen's d and is very well-established,  --> so thresholds—although arbitrary—are still fairly understood and agreed on. The outcome-informed ASMD score, on the other hand, being a multiply of the ASMD, no longer enjoys the familiarity and interpretability of the original ASMD. Therefore, its utility is only in its ranking, comparing covariates relative to other covariates in the same analytic sample.</p>
<p>However, when used to augment a Love plot, all that matters is how the outcome-informed ASMD score ranks covariates relative to each other, and specifically, ranking confounding variables above prognostic variables. Therefore, the limitation of the outcome-informed ASMD score being scale-less is irrelevant for the visualization task, and since the visualization only requires relative ranking, the outcome-informed ASMD score still faithfully fulfills its job.</p>
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>We have introduced an augmentation to the Love plot by incorporating additional information about covariate-outcome importance. Love plot is a common graphical diagnostic for group balancing methods in causal inference, visualizing the (Absolute) Standardized Mean Difference (ASMD) for each covariate before and after adjustment. ASMD alone, however, can be misleading if the covariates under investigation are not true confounding variables, influencing both exposure and outcome. Therefore, outcome-informed Love plot can help paint a fuller picture, emphasizing covariates that are both imbalanced <em>and</em> drive change in the outcome.</p>
<p><em>“Oui-Love plots”</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> is a modular, extendable, and easy-to-implement idea that can support the workflow of causal inference practitioners and we hope it will.</p>
</section>
</section>



<div id="quarto-appendix" class="default page-columns page-full"><section id="appendix" class="level2 appendix page-columns page-full"><h2 class="anchored quarto-appendix-heading">Appendix</h2><div class="quarto-appendix-contents page-columns page-full">

<section id="outcome-importance-only-vs.-outcome-informed-asmd-augmentation" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="outcome-importance-only-vs.-outcome-informed-asmd-augmentation">Outcome importance-only vs.&nbsp;outcome-informed ASMD augmentation</h4>
<p>Augmenting Love plots with outcome importance or the combined outcome informed ASMD score.</p>
<div class="page-columns page-full">
<div class="quarto-embed-nb-cell page-columns page-full">
<div id="cell-fig-ouiasmd-love" class="cell page-columns page-full" data-execution_count="33">
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-ouiasmd-love" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-ouiasmd-love-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<a href="index_files/figure-html/notebooks-ouilove_plot-fig-ouiasmd-love-output-1.svg" class="lightbox page-columns page-full" data-gallery="quarto-lightbox-gallery-5" data-glightbox="description: .lightbox-desc-5"><img src="index_files/figure-html/notebooks-ouilove_plot-fig-ouiasmd-love-output-1.svg" class="img-fluid figure-img column-body-outset"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ouiasmd-love-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Love plot augmented by outcome-informed ASMD. On the left, an outcome-informed Love plot augmented by covariate-outcome importance (Similar to <a href="#fig-love-oui-love" class="quarto-xref">Figure&nbsp;1</a>, right, but without ordering). On the right, an outcome-informed Love plot, but augmented by the combined outcome-importance ASMD score. While the former may emphasize prognostic variables too much (<span class="math inline">\(X_Y\)</span>), the latter is able to minimize their importance and emphasize instead confounding variables that have both larger covariate-outcome importance <em>and</em> have large ASMD.
</figcaption>
</figure>
</div>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-5" href="notebooks\ouilove_plot-preview.html#cell-fig-ouiasmd-love">Source: Outcome-informed Love plot</a></div>
</div>
</section>
<section id="outcome-informed-balance-plots" class="level4">
<h4 class="anchored" data-anchor-id="outcome-informed-balance-plots">Outcome-informed balance plots</h4>
<div class="quarto-embed-nb-cell">
<div id="cell-fig-oui-bal-plot" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display" data-execution_count="16">
<div id="fig-oui-bal-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oui-bal-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/notebooks-ouibalance_plot-fig-oui-bal-plot-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" data-glightbox="description: .lightbox-desc-6"><img src="index_files/figure-html/notebooks-ouibalance_plot-fig-oui-bal-plot-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oui-bal-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Encoding covariate-outcome importance information (right) in scatter plots (top) and slope graphs (bottom).
</figcaption>
</figure>
</div>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-6" href="notebooks\ouibalance_plot-preview.html#cell-fig-oui-bal-plot">Source: Outcome-informed balance plots</a></div>
<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">Figure&nbsp;1: Outcome-informed Love plot. On the left, a standard Love plot, showing covariates on the y-axis sorted by unadjusted ASMD, ASMD on the x-axis, unadjusted ASMDs as orange triangle and inverse propensity weighted ASMDs as blue circles. On the right, an Outcome-informed Love plot, encoding the combined importance of covariates on outcome prediction and exposure imbalance in three different visual channels: size (less important covariates are smaller), opacity(less important covariates are more transparent), and y-axis order (less important covariates are further down the panel). Outcome-informed Love plots reduce clutter and highlight the more important covariates to which examine balancing on.</span>
<span class="glightbox-desc lightbox-desc-2">Figure&nbsp;2: Encoding covariate-outcome importance information as marker opacity, marker size, and covariate order. Opacity and size allow less important covariates to appear more salient by making them more transparent or smaller, respectively. Y-axis order moves less important covariates further down the plot, focusing more important covariates in a specific region of the figure.</span>
<span class="glightbox-desc lightbox-desc-3">Figure&nbsp;3: Outcome-informed ASMD score. A) Inverse propensity weighted ASMD, with 0.1 threshold reference (dashed) B) Covariate-outcome importance score (mean decrease in mean square error). C) Outcome-informed ASMD, generated by multiplying the above two. The ASMD emphasizes covariate-exposure associations (<span class="math inline">\(X_A, X_{AY}\)</span>), the outcome-importance score emphasizes covariate-outcome associations (<span class="math inline">\(X_Y, X_{AY}\)</span>), and outcome-informed ASMD emphasizes the interaction of the former two scores (<span class="math inline">\(X_{AY}\)</span>).<br>
</span>
<span class="glightbox-desc lightbox-desc-4">Figure&nbsp;4: Confounding structure underlying the simulation example. Right is the true confounding structure where <span class="math inline">\(X_0\)</span> is not associated with neither the exposure <span class="math inline">\(A\)</span> nor the outcome <span class="math inline">\(Y\)</span>, <span class="math inline">\(X_A\)</span> only influence the exposure, <span class="math inline">\(X_Y\)</span> only influences the outcome, and <span class="math inline">\(X_{AY}\)</span> is the only true confounder influencing both <span class="math inline">\(A\)</span> and <span class="math inline">\(Y\)</span>. Left is the assumed confounding structure where all variables assumed to be confounders influencing both the treatment and the outcome. Wrongly specified edges are depicted red and dashed.</span>
<span class="glightbox-desc lightbox-desc-5">Figure&nbsp;5: Love plot augmented by outcome-informed ASMD. On the left, an outcome-informed Love plot augmented by covariate-outcome importance (Similar to <a href="#fig-love-oui-love" class="quarto-xref">Figure&nbsp;1</a>, right, but without ordering). On the right, an outcome-informed Love plot, but augmented by the combined outcome-importance ASMD score. While the former may emphasize prognostic variables too much (<span class="math inline">\(X_Y\)</span>), the latter is able to minimize their importance and emphasize instead confounding variables that have both larger covariate-outcome importance <em>and</em> have large ASMD.</span>
<span class="glightbox-desc lightbox-desc-6">Figure&nbsp;6: Encoding covariate-outcome importance information (right) in scatter plots (top) and slope graphs (bottom).</span>
</div>

</section>
</div></section><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-ahmed2006heart" class="csl-entry" role="listitem">
Ahmed, Ali, Ahsan Husain, Thomas E Love, Giovanni Gambassi, Louis J Dell’Italia, Gary S Francis, Mihai Gheorghiade, Richard M Allman, Sreelatha Meleth, and Robert C Bourge. 2006. <span>“Heart Failure, Chronic Diuretic Use, and Increase in Mortality and Hospitalization: An Observational Study Using Propensity Score Methods.”</span> <em>European Heart Journal</em> 27 (12): 1431–39.
</div>
<div id="ref-ali2015reporting" class="csl-entry" role="listitem">
Ali, M Sanni, Rolf HH Groenwold, Svetlana V Belitser, Wiebe R Pestman, Arno W Hoes, Kit CB Roes, Anthonius de Boer, and Olaf H Klungel. 2015. <span>“Reporting of Covariate Selection and Balance Assessment in Propensity Score Analysis Is Suboptimal: A Systematic Review.”</span> <em>Journal of Clinical Epidemiology</em> 68 (2): 122–31.
</div>
<div id="ref-austin2009balance" class="csl-entry" role="listitem">
Austin, Peter C. 2009. <span>“Balance Diagnostics for Comparing the Distribution of Baseline Covariates Between Treatment Groups in Propensity-Score Matched Samples.”</span> <em>Statistics in Medicine</em> 28 (25): 3083–3107.
</div>
<div id="ref-breiman2001random" class="csl-entry" role="listitem">
Breiman, Leo. 2001. <span>“Random Forests.”</span> <em>Machine Learning</em> 45: 5–32.
</div>
<div id="ref-ding2017instrumental" class="csl-entry" role="listitem">
Ding, Peng, TJ VanderWeele, and James M Robins. 2017. <span>“Instrumental Variables as Bias Amplifiers with General Outcome and Confounding.”</span> <em>Biometrika</em> 104 (2): 291–302.
</div>
<div id="ref-granger2020review" class="csl-entry" role="listitem">
Granger, Emily, Tim Watkins, Jamie C Sergeant, and Mark Lunt. 2020. <span>“A Review of the Use of Propensity Score Diagnostics in Papers Published in High-Ranking Medical Journals.”</span> <em>BMC Medical Research Methodology</em> 20: 1–9.
</div>
<div id="ref-greenland1999causal" class="csl-entry" role="listitem">
Greenland, Sander, Judea Pearl, and James M Robins. 1999. <span>“Causal Diagrams for Epidemiologic Research.”</span> <em>Epidemiology</em> 10 (1): 37–48.
</div>
<div id="ref-harrell2001regression" class="csl-entry" role="listitem">
Harrell, Frank E et al. 2001. <em>Regression Modeling Strategies: With Applications to Linear Models, Logistic Regression, and Survival Analysis</em>. Springer.
</div>
<div id="ref-hernan2002causal" class="csl-entry" role="listitem">
Hernán, Miguel A, Sonia Hernández-Dı́az, Martha M Werler, and Allen A Mitchell. 2002. <span>“Causal Knowledge as a Prerequisite for Confounding Evaluation: An Application to Birth Defects Epidemiology.”</span> <em>American Journal of Epidemiology</em> 155 (2): 176–84.
</div>
<div id="ref-shalev2014understanding" class="csl-entry" role="listitem">
Shalev-Shwartz, Shai, and Shai Ben-David. 2014. <em>Understanding Machine Learning: From Theory to Algorithms</em>. Cambridge university press.
</div>
<div id="ref-tennant2021use" class="csl-entry" role="listitem">
Tennant, Peter WG, Eleanor J Murray, Kellyn F Arnold, Laurie Berrie, Matthew P Fox, Sarah C Gadd, Wendy J Harrison, et al. 2021. <span>“Use of Directed Acyclic Graphs (DAGs) to Identify Confounders in Applied Health Research: Review and Recommendations.”</span> <em>International Journal of Epidemiology</em> 50 (2): 620–32.
</div>
<div id="ref-vanderweele2019principles" class="csl-entry" role="listitem">
VanderWeele, Tyler J. 2019. <span>“Principles of Confounder Selection.”</span> <em>European Journal of Epidemiology</em> 34: 211–19.
</div>
<div id="ref-wilke2019fundamentals" class="csl-entry" role="listitem">
Wilke, Claus O. 2019. <em>Fundamentals of Data Visualization: A Primer on Making Informative and Compelling Figures</em>. O’Reilly Media.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We will use “accuracy” in a colloquial manner throughout.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Yes, we love plots.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","loop":false,"descPosition":"bottom","openEffect":"zoom","selector":".lightbox"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>